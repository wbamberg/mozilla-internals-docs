<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="https://code.cdn.mozilla.net/fonts/zilla-slab.css"/>
    <link rel="stylesheet" href="/css/page.css"/>
    <title>Multiple Queries</title>
  </head>

  <body><nav class="breadcrumbs"><a href="../../../../Mozilla.html">Mozilla</a>&raquo;<a href="../../../Tech.html">Tech</a>&raquo;<a href="../../XUL.html">XUL</a>&raquo;<a href="../Template_Guide.html">Template_Guide</a></nav><div class="content-heading"><h1>Multiple Queries</h1></div>
<div class="content"><p>
</p>
<div class="prevnext" style="text-align: right;">
 <p>
  <a href="/en-US/docs/Mozilla/Tech/XUL/Template_Guide/Special_Condition_Tests" style="float: left;">
   « Previous
  </a>
  <a href="/en-US/docs/Mozilla/Tech/XUL/Template_Guide/Using_Multiple_Queries_to_Generate_More_Results">
   Next  »
  </a>
 </p>
</div>
<p>
</p>
<p>
 So far, every template has contained only a single query, even for recursive content. However, it is possible to use multiple queries. This may be used to combine the results from several queries together, or may be used to generate different types of results when recursive iterations. To use multiple queries, place each
 <code>
  <a href="/en-US/docs/Mozilla/Tech/XUL/query" title="query">
   query
  </a>
 </code>
 element along with its rules inside a
 <code>
  <a href="/en-US/docs/Mozilla/Tech/XUL/queryset" title="queryset">
   queryset
  </a>
 </code>
 element. The
 <code>
  queryset
 </code>
 element is a bit of a misnomer, it actually only contains one query each.
</p>
<p>
 The following is the basic structure of a template with multiple queries:
</p>
<pre>&lt;listbox datasources="..." ref="..."&gt;
  &lt;queryset&gt;
    &lt;query&gt;
      ...
    &lt;/query&gt;
    &lt;rule&gt;
      ...
    &lt;/rule&gt;
  &lt;/queryset&gt;
  &lt;queryset&gt;
    &lt;query&gt;
      ...
    &lt;/query&gt;
    &lt;rule&gt;
      ...
    &lt;/rule&gt;
  &lt;/queryset&gt;
&lt;/listbox&gt;
</pre>
<p>
 Each
 <code>
  queryset
 </code>
 holds a query and its set of rules. If there is only rule, the
 <code>
  rule
 </code>
 element may be omitted as is the case when only one query is used. The results from the first query are generated first and output generated for it, followed by the results and output for the second query, and so forth for all of the queries. Here is
 <a class="external" href="http://developer.mozilla.org/samples/xultemp/template-guide-ex22.xul">
  an example
 </a>
 using an RDF datasource:
</p>
<pre>&lt;hbox id="photosList" datasources="template-guide-photos3.rdf"
      ref="http://www.xulplanet.com/rdf/myphotos"&gt;
  &lt;template&gt;
    &lt;queryset&gt;
      &lt;query&gt;
        &lt;content uri="?start"/&gt;
        &lt;member container="?start" child="?photo"/&gt;
        &lt;triple subject="?photo"
                predicate="http://purl.org/dc/elements/1.1/title"
                object="Canal"/&gt;
      &lt;/query&gt;
      &lt;action&gt;
        &lt;button uri="?photo" image="?photo" label="View" orient="vertical"/&gt;
      &lt;/action&gt;
    &lt;/queryset&gt;
    &lt;queryset&gt;
      &lt;query&gt;
        &lt;content uri="?start"/&gt;
        &lt;member container="?start" child="?photo"/&gt;
      &lt;/query&gt;
      &lt;action&gt;
        &lt;image uri="?photo" src="?photo"/&gt;
      &lt;/action&gt;
    &lt;/queryset&gt;
  &lt;/template&gt;
&lt;/hbox&gt;
</pre>
<p>
 This template contains two queries, the first contains a &lt;triple&gt; which matches only the photo with a title of 'Canal'. The second query doesn't contain such a triple and will match all three of the photos. It the first query was used by itself, only one result would match. If the second query was used by itself, three results would match. When used together in this example, the results are combined and only three results are shown. However, you will probably notice that the one photo that matches the first query has appeared differently that the others. In fact, the content for this photo is that of the first query with the button, whereas the content for the other photos are that of the second query with the normal images.
</p>
<p>
 <br>
  This method of using multiple queries allows different content to generated for each query. In this particular example, we could actually have used two rules instead. This would be a better idea as it only requires one query, is simpler and more efficient, however you could imagine a more complex query where this wasn't possible.
 </br>
</p>
<h3 id="How_Multiple_Queries_are_Processed" name="How_Multiple_Queries_are_Processed">
 How Multiple Queries are Processed
</h3>
<p>
 We already know that a query generates a set of results. There's no magic to the way in which the template builder processes multiple queries. It just takes the results generated from the first query, adds the results for the second query, adds the results for the third query, and so on. Here are the results that would be generated by the first query above, before any bindings are applied:
</p>
<pre>(?start = http://www.xulplanet.com/rdf/myphotos,
 ?photo = http://www.xulplanet.com/ndeakin/images/t/canal.jpg,
</pre>
<p>
 Then, the builder adds the three results generated from the second query:
</p>
<pre>(?start = http://www.xulplanet.com/rdf/myphotos,
 ?photo = http://www.xulplanet.com/ndeakin/images/t/canal.jpg)
(?start = http://www.xulplanet.com/rdf/myphotos,
 ?photo = http://www.xulplanet.com/ndeakin/images/t/palace.jpg)
(?start = http://www.xulplanet.com/rdf/myphotos,
 ?photo = http://www.xulplanet.com/ndeakin/images/t/canal.jpg)
(?start = http://www.xulplanet.com/rdf/myphotos,
 ?photo = http://www.xulplanet.com/ndeakin/images/t/obelisk.jpg)
</pre>
<p>
 So four possible results are available, one from the first query and three from the second. However,
 <a class="external" href="http://developer.mozilla.org/samples/xultemp/template-guide-ex22.xul">
  the example
 </a>
 shows that only content for three results are generated. What happened to the fourth result?
</p>
<p>
 This is where the useful aspect of multiple queries comes in. Note that two of the results above are actually for the same photo (canal.jpg). The template builder removes any duplicate items before generating content. It does this by only allowing the match for the earliest query. That is, the canal.jpg generated by the second query is removed, since an earlier query (the first query) already generated a match for that result.
</p>
<p>
 One important distinction is that the determination of duplicates is only based on the member variable, in this case the ?photo variable. It doesn't matter whether other variables are the same or not.
</p>
<p>
 If you look at the example again, you might notice that the canal photo that matches the first query has appeared in-between the other two photos, even though those photos are generated from the second query. The builder hasn't put all the matches for the first query before the matches for the second query. In fact, the order is the same as the examples that only use one query. Compare the
 <a class="external" href="http://developer.mozilla.org/samples/xultemp/template-guide-ex22.xul">
  multiple query example
 </a>
 with an
 <a class="external" href="http://developer.mozilla.org/samples/xultemp/template-guide-ex11.xul">
  earlier example
 </a>
 that used only a single query. The photos have appeared in the same order in both cases.
</p>
<p>
 This is because the builder notices that the photos are in an RDF Seq in the datasource and arranges them in the order they appear in the Seq. This and other automated sorting done by the template builder is a fairly complicated process that will be discussed in more detail later.
</p>
<h3 id="Multiple_Queries_Using_the_RDF_Simple_Syntax" name="Multiple_Queries_Using_the_RDF_Simple_Syntax">
 Multiple Queries Using the RDF Simple Syntax
</h3>
<p>
 You can also use multiple queries with RDF datasources using the simple query syntax. Here is the previous example rewritten using the simple syntax:
</p>
<pre>&lt;hbox id="photosList" datasources="template-guide-photos3.rdf"
      ref="http://www.xulplanet.com/rdf/myphotos"
      xmlns:dc="http://purl.org/dc/elements/1.1/"&gt;
  &lt;template&gt;
    &lt;rule dc:title="Canal"&gt;
      &lt;button uri="rdf:*" image="rdf:*" label="View" orient="vertical"/&gt;
    &lt;/rule&gt;
    &lt;rule&gt;
      &lt;image uri="rdf:*" src="rdf:*"/&gt;
    &lt;/rule&gt;
  &lt;/template&gt;
&lt;/hbox&gt;
</pre>
<p>
 The result to the user in
 <a class="external" href="http://developer.mozilla.org/samples/xultemp/template-guide-ex23.xul">
  this example
 </a>
 is the same as the
 <a class="external" href="http://developer.mozilla.org/samples/xultemp/template-guide-ex22.xul">
  previous example
 </a>
 . You can also mix simple and extended queries in one template, although you may prefer to use the same style in all queries for consistency.
</p>
<p>
 However, if you are going to be using a number of queries, the template builder is more efficient when using multiple queries using the simple query syntax. This is because all simple queries will iterate over the same data, usually the children of an RDF container. So the builder only performs this step once and filters the data for each query.
</p>
<p>
 When using the extended query syntax, the manner in which the graph is navigated may be different for every query, so no optimization can be done. The builder needs to process every condition of every query. If, for example, you have six queries, each with a &lt;member&gt; condition, the builder will need to construct the children six times. You probably won't notice any difference for small amounts of data such as the photos example we've been using, but you might for large datasets. Thus, you will want to use the simple query syntax when possible.
</p>
<p>
 If you are only going to be using one query, it doesn't matter, of course. Speaking of using a single query, the simple query syntax allows a slight shorthand. You can remove the &lt;rule&gt; element and place the rule's conditions directly on the &lt;template&gt;. There's no performance benefit, but it does save some typing.
</p>
<pre>&lt;hbox id="photosList" datasources="template-guide-photos3.rdf"
      ref="http://www.xulplanet.com/rdf/myphotos"
      xmlns:dc="http://purl.org/dc/elements/1.1/"&gt;
  &lt;template dc:title="Canal"&gt;
      &lt;button uri="rdf:*" image="rdf:*" label="View" orient="vertical"/&gt;
  &lt;/template&gt;
&lt;/hbox&gt;
</pre>
<p>
 <a class="external" href="http://developer.mozilla.org/samples/xultemp/template-guide-ex23b.xul">
  This example
 </a>
 shows only a single photo since a condition is used to filter out the other two photos. Note that in this shorthand, the query conditions are placed directly on the &lt;template&gt; element.
</p>
<p>
</p>
<div class="prevnext" style="text-align: right;">
 <p>
  <a href="/en-US/docs/Mozilla/Tech/XUL/Template_Guide/Special_Condition_Tests" style="float: left;">
   « Previous
  </a>
  <a href="/en-US/docs/Mozilla/Tech/XUL/Template_Guide/Using_Multiple_Queries_to_Generate_More_Results">
   Next  »
  </a>
 </p>
</div>
<p>
</p></div><div id="footer"><hr/><p>This page was originally written for <a href="https://developer.mozilla.org">developer.mozilla.org</a> and is used here under the <a href="http://creativecommons.org/licenses/by-sa/2.5/">Creative Commons Attribution-ShareAlike license</a> (CC-BY-SA).</p>
<p>Original contributors to this page: <a href="https://developer.mozilla.org/en-US/profiles/wbamberg">wbamberg</a>, <a href="https://developer.mozilla.org/en-US/profiles/Sheppy">Sheppy</a>, <a href="https://developer.mozilla.org/en-US/profiles/Brettz9">Brettz9</a>, <a href="https://developer.mozilla.org/en-US/profiles/Enn">Enn</a>.</p></div></body>
</html>
