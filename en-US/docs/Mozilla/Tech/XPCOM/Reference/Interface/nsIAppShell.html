<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="https://code.cdn.mozilla.net/fonts/zilla-slab.css"/>
    <link rel="stylesheet" href="/css/page.css"/>
    <title>nsIAppShell</title>
  </head>

  <body><nav class="breadcrumbs"><a href="../../../../../Mozilla.html">Mozilla</a>&raquo;<a href="../../../../Tech.html">Tech</a>&raquo;<a href="../../../XPCOM.html">XPCOM</a>&raquo;<a href="../../Reference.html">Reference</a>&raquo;<a href="../Interface.html">Interface</a></nav><div class="content-heading"><h1>nsIAppShell</h1></div>
<div class="content"><p></p><div style="border: solid #ddd 2px; margin-bottom: 12px;">
<div style="background: #eee; padding: 2px;"><code><a href="https://dxr.mozilla.org/mozilla-central/source/widget/public/nsIAppShell.idl" rel="custom">widget/public/nsIAppShell.idl</a></code><span style="text-align: right; float: right;"><span style="color: #cc0000; font-weight: 700;">Not scriptable</span></span></div>
<span style="padding: 4px 2px;">

Interface for the native event system layer. This interface is designed to be used on the main application thread only.
</span>

<div style="background: #eee; padding: 2px;">
Inherits from: <code><a href="/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsISupports" title="">nsISupports</a></code>
<span style="text-align: right; float: right;">Last changed in Gecko 2.0 (Firefox 4 / Thunderbird 3.3 / SeaMonkey 2.1)</span></div>
</div><p></p>
<h2 id="Method_overview" name="Method_overview">Method overview</h2>
<table class="standard-table"> <tbody> <tr> <td><code>void <a href="#Create()">Create</a>(inout int argc, inout string argv);</code> <span class="inlineIndicator obsolete obsoleteInline" title="(Firefox 3)">Obsolete since Gecko 1.9</span></td> </tr> <tr> <td><code>void <a href="#DispatchNativeEvent()">DispatchNativeEvent</a>(in PRBool aRealEvent, in voidPtr aEvent);</code> <span class="inlineIndicator obsolete obsoleteInline" title="(Firefox 3)">Obsolete since Gecko 1.9</span></td> </tr> <tr> <td><code>void <a href="#exit()">exit</a>();</code></td> </tr> <tr> <td><code>void <a href="#favorPerformanceHint()">favorPerformanceHint</a>(in boolean favorPerfOverStarvation, in unsigned long starvationDelay);</code> </td> </tr> <tr> <td><code>void <a href="#GetNativeEvent()">GetNativeEvent</a>(in PRBoolRef aRealEvent, in voidPtrRef aEvent);</code> <span class="inlineIndicator obsolete obsoleteInline" title="(Firefox 3)">Obsolete since Gecko 1.9</span></td> </tr> <tr> <td><code>void <a href="#ListenToEventQueue()">ListenToEventQueue</a>(in nsIEventQueue aQueue, in PRBool aListen);</code> <span class="inlineIndicator obsolete obsoleteInline" title="(Firefox 3)">Obsolete since Gecko 1.9</span></td> </tr> <tr> <td><code>void <a href="#resumeNative()">resumeNative</a>();</code> </td> </tr> <tr> <td><code>void <a href="#run()">run</a>();</code></td> </tr> <tr> <td><code>void <a href="#runInStableState()">runInStableState</a>(in nsIRunnable aRunnable);</code> </td> </tr> <tr> <td><code>void <a href="#Spindown()">Spindown</a>();</code> <span class="inlineIndicator obsolete obsoleteInline" title="(Firefox 3)">Obsolete since Gecko 1.9</span></td> </tr> <tr> <td><code>void <a href="#Spinup()">Spinup</a>();</code> <span class="inlineIndicator obsolete obsoleteInline" title="(Firefox 3)">Obsolete since Gecko 1.9</span></td> </tr> <tr> <td><code>void <a href="#suspendNative()">suspendNative</a>();</code> </td> </tr> </tbody>
</table>
<h2 id="Attributes" name="Attributes">Attributes</h2>
<table class="standard-table"> <tbody> <tr> <td class="header">Attribute</td> <td class="header">Type</td> <td class="header">Description</td> </tr> <tr> <td><code>eventloopNestingLevel</code></td> <td><code><a href="/en/unsigned_long" title="en/unsigned long">unsigned long</a></code></td> <td>The current event loop nesting level. <strong>Read only.</strong> </td> </tr> </tbody>
</table>
<h2 id="Methods" name="Methods">Methods</h2>
<p></p><div class="headingWithIndicator">
        <h3 id="Create()">Create()</h3>
        <span class="indicatorInHeadline obsolete obsoleteMethod">Obsolete since Gecko 1.9 (Firefox 3)</span>
        </div><p></p>
<p>Creates an application shell.</p>
<pre class="eval">void Create(
  inout int argc,
  inout string argv
);
</pre>
<h6 id="Parameters" name="Parameters">Parameters</h6>
<dl> <dt><code>argc</code></dt> <dd>The number of parameters passed in on the command line.</dd> <dt><code>argv</code></dt> <dd>A direct reference to the parameter array.</dd>
</dl>
<p></p><div class="headingWithIndicator">
        <h3 id="DispatchNativeEvent()">DispatchNativeEvent()</h3>
        <span class="indicatorInHeadline obsolete obsoleteMethod">Obsolete since Gecko 1.9 (Firefox 3)</span>
        </div><p></p>
<p>After event dispatch execute app specific code.</p>
<pre class="eval">void DispatchNativeEvent(
  in PRBool aRealEvent,
  in voidPtr aEvent
);
</pre>
<h6 id="Parameters" name="Parameters">Parameters</h6>
<dl> <dt><code>aRealEvent</code></dt> <dd>Event is real or a <code>null</code> placeholder (Macintosh).</dd> <dt><code>aEvent</code></dt> <dd>Void pointer to native event structure.</dd>
</dl>
<h3 id="exit()" name="exit()">exit()</h3>
<p>Exit the handle event loop.</p>
<pre class="eval">void exit();
</pre>
<h6 id="Parameters" name="Parameters">Parameters</h6>
<p>None.</p>
<p></p><h3 id="favorPerformanceHint()">favorPerformanceHint()</h3><p></p>
<p>Give hint to native event queue notification mechanism. If the native platform needs to tradeoff performance vs. native event starvation this hint tells the native dispatch code which to favor. The default is to prevent native event starvation.</p>
<p>Calls to this function may be nested. When the number of calls that pass <code>PR_TRUE</code> is subtracted from the number of calls that pass <code>PR_FALSE</code> is greater than 0, performance is given precedence over preventing event starvation.</p>
<pre class="eval">void favorPerformanceHint(
  in boolean favorPerfOverStarvation,
  in unsigned long starvationDelay
);
</pre>
<h6 id="Parameters" name="Parameters">Parameters</h6>
<dl> <dt><code>favorPerfOverStarvation</code></dt> <dd><code>true</code> to favor event performance over event starvation, <code>false</code> to favor event starvation over event performance.</dd> <dt><code>starvationDelay</code></dt> <dd>Is only used when <code>favorPerfOverStarvation</code> is <code>PR_FALSE</code>. It is the amount of time in milliseconds to wait before the <code>PR_FALSE</code> actually takes effect.</dd>
</dl>
<p></p><div class="headingWithIndicator">
        <h3 id="GetNativeEvent()">GetNativeEvent()</h3>
        <span class="indicatorInHeadline obsolete obsoleteMethod">Obsolete since Gecko 1.9 (Firefox 3)</span>
        </div><p></p>
<p>After event dispatch execute app specific code.</p>
<pre class="eval">void GetNativeEvent(
  in PRBoolRef aRealEvent,
  in voidPtrRef aEvent
);
</pre>
<h6 id="Parameters" name="Parameters">Parameters</h6>
<dl> <dt><code>aRealEvent</code></dt> <dd>Event is real or a <code>null</code> placeholder (Macintosh).</dd> <dt><code>aEvent</code></dt> <dd>Void pointer to native event structure.</dd>
</dl>
<p></p><div class="headingWithIndicator">
        <h3 id="ListenToEventQueue()">ListenToEventQueue()</h3>
        <span class="indicatorInHeadline obsolete obsoleteMethod">Obsolete since Gecko 1.9 (Firefox 3)</span>
        </div><p></p>
<p>An event queue has been created or destroyed. Hook or unhook it from your system, as necessary.</p>
<pre class="eval">void ListenToEventQueue(
  in nsIEventQueue aQueue,
  in PRBool aListen
);
</pre>
<h6 id="Parameters" name="Parameters">Parameters</h6>
<dl> <dt><code>aQueue</code></dt> <dd>The queue in question.</dd> <dt><code>aListen</code></dt> <dd><code>PR_TRUE</code> for a new queue wanting hooking up. <code>PR_FALSE</code> for a queue wanting to be unhooked.</dd>
</dl>
<p></p><h3 id="resumeNative()">resumeNative()</h3><p></p>
<p>Resumes the use of additional platform-specific methods to <code><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIAppShell#run()">run()</a></code> Gecko events on the main application thread. Calls to <code><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIAppShell#suspendNative()">suspendNative()</a></code> and <code>resumeNative</code> may be nested. On some platforms this will be a no-op.</p>
<pre class="eval">void resumeNative();
</pre>
<h6 id="Parameters" name="Parameters">Parameters</h6>
<p>None.</p>
<h3 id="run()" name="run()">run()</h3>
<p>Enter an event loop. Do not leave until <code><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIAppShell#exit()">exit()</a></code> is called.</p>
<pre class="eval">void run();
</pre>
<h6 id="Parameters" name="Parameters">Parameters</h6>
<p>None.</p>
<p></p><h3 id="runInStableState()">runInStableState()</h3><p></p>
<p>Allows running of a "synchronous section", in the form of an <code><a href="/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIRunnable" title="">nsIRunnable</a></code> once the event loop has reached a "stable state". A stable state is reached when the currently executing task/event has finished, (see: <a class=" external" href="http://www.whatwg.org/specs/web-apps/current-work/multipage/webappapis.html#synchronous-section">webappapis.html#synchronous-section</a>). In practice this runs <code>aRunnable</code> once the currently executing event finishes. If called multiple times per task/event, all the runnables will be executed, in the order in which <code>runInStableState</code> was called.</p>
<pre class="eval">void runInStableState(
  in nsIRunnable aRunnable
);
</pre>
<h6 id="Parameters" name="Parameters">Parameters</h6>
<dl> <dt><code>aRunnable</code></dt> <dd>An <code><a href="/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIRunnable" title="">nsIRunnable</a></code> to run.</dd>
</dl>
<p></p><div class="headingWithIndicator">
        <h3 id="Spindown()">Spindown()</h3>
        <span class="indicatorInHeadline obsolete obsoleteMethod">Obsolete since Gecko 1.9 (Firefox 3)</span>
        </div><p></p>
<p>Prepare to stop processing events.</p>
<pre class="eval">void Spindown();
</pre>
<h6 id="Parameters" name="Parameters">Parameters</h6>
<p>None.</p>
<p></p><div class="headingWithIndicator">
        <h3 id="Spinup()">Spinup()</h3>
        <span class="indicatorInHeadline obsolete obsoleteMethod">Obsolete since Gecko 1.9 (Firefox 3)</span>
        </div><p></p>
<p>Prepare to process events.</p>
<pre class="eval">void Spinup();
</pre>
<h6 id="Parameters" name="Parameters">Parameters</h6>
<p>None.</p>
<p></p><h3 id="suspendNative()">suspendNative()</h3><p></p>
<p>Suspends the use of additional platform-specific methods (besides the <code>nsIAppShell</code>-&gt;<code><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIAppShell#run()">run()</a></code> event loop) to run Gecko events on the main application thread. Under some circumstances these "additional methods" can cause Gecko event handlers to be re-entered, sometimes leading to hangs and crashes. Calls to <code>suspendNative</code> and <code><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIAppShell#resumeNative()">resumeNative()</a></code> may be nested. On some platforms (those that do not use any "additional methods") this will be a no-op. Does not (in itself) stop Gecko events from being processed on the main application thread. But if the <code>nsIAppShell</code>-&gt;<code><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIAppShell#run()">run()</a></code> event loop is blocked when this call is made, Gecko events will stop being processed until <code><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIAppShell#resumeNative()">resumeNative()</a></code> is called (even if a plugin or library is temporarily processing events on a nested event loop).</p>
<pre class="eval">void suspendNative();
</pre>
<h6 id="Parameters" name="Parameters">Parameters</h6>
<p>None.</p></div><div id="footer"><hr/><p>This page was originally written for <a href="https://developer.mozilla.org">developer.mozilla.org</a> and is used here under the <a href="http://creativecommons.org/licenses/by-sa/2.5/">Creative Commons Attribution-ShareAlike license</a> (CC-BY-SA).</p>
<p>Original contributors to this page: <a href="https://developer.mozilla.org/en-US/profiles/wbamberg">wbamberg</a>, <a href="https://developer.mozilla.org/en-US/profiles/Sheppy">Sheppy</a>, <a href="https://developer.mozilla.org/en-US/profiles/trevorh">trevorh</a>, <a href="https://developer.mozilla.org/en-US/profiles/kriks">kriks</a>, <a href="https://developer.mozilla.org/en-US/profiles/Ayhfung">Ayhfung</a>.</p></div></body>
</html>
