<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="https://code.cdn.mozilla.net/fonts/zilla-slab.css"/>
    <link rel="stylesheet" href="/css/page.css"/>
    <title>nsIDownloadProgressListener</title>
  </head>

  <body><nav class="breadcrumbs"><a href="../../../../../Mozilla.html">Mozilla</a>&raquo;<a href="../../../../Tech.html">Tech</a>&raquo;<a href="../../../XPCOM.html">XPCOM</a>&raquo;<a href="../../Reference.html">Reference</a>&raquo;<a href="../Interface.html">Interface</a></nav><div class="content-heading"><h1>nsIDownloadProgressListener</h1></div>
<div class="content"><p>
</p>
<div style="border: solid #ddd 2px; margin-bottom: 12px;">
 <div style="background: #eee; padding: 2px;">
  <code>
   <a href="https://dxr.mozilla.org/mozilla-central/source//toolkit/components/downloads/nsIDownloadProgressListener.idl" rel="custom">
    /toolkit/components/downloads/nsIDownloadProgressListener.idl
   </a>
  </code>
  <span style="text-align: right; float: right;">
   <a href="https://developer.mozilla.org/en-US/docs/Interfaces/About_Scriptable_Interfaces" style="color: #00cc00; font-weight: 700;">
    Scriptable
   </a>
  </span>
 </div>
 <span style="padding: 4px 2px;">
  This interface gives applications and extensions a way to monitor the status of downloads being processed by the Download Manager.
 </span>
 <div style="background: #eee; padding: 2px;">
  Inherits from:
  <code>
   <a href="/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsISupports" title="">
    nsISupports
   </a>
  </code>
  <span style="text-align: right; float: right;">
   Last changed in Gecko 1.9.1 (Firefox 3.5 / Thunderbird 3.0 / SeaMonkey 2.0)
  </span>
 </div>
</div>
<p>
</p>
<p>
 To use simply implement this interface in your code, then call
 <code>
  <a href="/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIDownloadManager">
   nsIDownloadManager.addListener()
  </a>
 </code>
 to start listening.
</p>
<p>
 When you no longer need to listen to the Download Manager's state, call
 <code>
  <a href="/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIDownloadManager">
   nsIDownloadManager.removeListener()
  </a>
 </code>
 to stop listening.
</p>
<p>
 As the states of downloads change, the methods described here are called by the Download Manager so your code can take whatever steps it needs to.
</p>
<p>
 This interface works very similarly to the
 <code>
  <a href="/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIWebProgress" title="">
   nsIWebProgress
  </a>
 </code>
 interface. It is important to note that there is no service for this listener. Rather, the developer must create an object with the methods provided below to implement it.
</p>
<h2 id="Method_overview" name="Method_overview">
 Method overview
</h2>
<table class="standard-table">
 <tbody>
  <tr>
   <td>
    <code>
     void
     <a href="#onDownloadStateChange()">
      onDownloadStateChange
     </a>
     (in short aState, in nsIDownload aDownload);
    </code>
   </td>
  </tr>
  <tr>
   <td>
    <code>
     void
     <a href="#onLocationChange()">
      onLocationChange
     </a>
     (in nsIWebProgress aWebProgress, in nsIRequest aRequest, in nsIURI aLocation, in nsIDownload aDownload);
    </code>
    <span class="inlineIndicator obsolete obsoleteInline" title="(Firefox 3.5 / Thunderbird 3.0 / SeaMonkey 2.0)">
     Obsolete since Gecko 1.9.1
    </span>
   </td>
  </tr>
  <tr>
   <td>
    <code>
     void
     <a href="#onProgressChange()">
      onProgressChange
     </a>
     (in nsIWebProgress aWebProgress, in nsIRequest aRequest, in long long aCurSelfProgress, in long long aMaxSelfProgress, in long long aCurTotalProgress, in long long aMaxTotalProgress, in nsIDownload aDownload);
    </code>
   </td>
  </tr>
  <tr>
   <td>
    <code>
     void
     <a href="#onSecurityChange()">
      onSecurityChange
     </a>
     (in nsIWebProgress aWebProgress, in nsIRequest aRequest, in unsigned long aState, in nsIDownload aDownload);
    </code>
   </td>
  </tr>
  <tr>
   <td>
    <code>
     void
     <a href="#onStateChange()">
      onStateChange
     </a>
     (in nsIWebProgress aWebProgress, in nsIRequest aRequest, in unsigned long aStateFlags, in nsresult aStatus, in nsIDownload aDownload);
    </code>
   </td>
  </tr>
  <tr>
   <td>
    <code>
     void
     <a href="#onStatusChange()">
      onStatusChange
     </a>
     (in nsIWebProgress aWebProgress, in nsIRequest aRequest, in nsresult aStatus, in wstring aMessage, in nsIDownload aDownload);
    </code>
    <span class="inlineIndicator obsolete obsoleteInline" title="(Firefox 3.5 / Thunderbird 3.0 / SeaMonkey 2.0)">
     Obsolete since Gecko 1.9.1
    </span>
   </td>
  </tr>
 </tbody>
</table>
<h2 id="Attributes" name="Attributes">
 Attributes
</h2>
<table class="standard-table">
 <tbody>
  <tr>
   <td class="header">
    Attribute
   </td>
   <td class="header">
    Type
   </td>
   <td class="header">
    Description
   </td>
  </tr>
  <tr>
   <td>
    <code>
     document
    </code>
   </td>
   <td>
    <code>
     <code>
      <a href="/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIDOMDocument" title="">
       nsIDOMDocument
      </a>
     </code>
    </code>
   </td>
   <td>
    <code>
     document
    </code>
    The
    <code>
     document
    </code>
    of the download manager frontend.
   </td>
  </tr>
 </tbody>
</table>
<h2 id="Methods" name="Methods">
 Methods
</h2>
<p>
</p>
<h3 id="onDownloadStateChange()">
 onDownloadStateChange()
</h3>
<p>
</p>
<p>
 Called when the status of a particular download changes.
</p>
<pre class="eval">void onDownloadStateChange(
  in short aState,
  in nsIDownload aDownload
);
</pre>
<h6 id="Parameters" name="Parameters">
 Parameters
</h6>
<dl>
 <dt>
  <code>
   aState
  </code>
 </dt>
 <dd>
  The previous state of the download. See
  <code>
   <a href="/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIDownloadManager">
    nsIDownloadManager.Constants
   </a>
  </code>
  for a list of possible values.
 </dd>
 <dt>
  <code>
   aDownload
  </code>
 </dt>
 <dd>
  The
  <code>
   <a href="/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIDownload" title="">
    nsIDownload
   </a>
  </code>
  object representing the file whose download status has changed. You can get the new state of the download from this object.
 </dd>
</dl>
<p>
</p>
<div class="headingWithIndicator">
 <h3 id="onLocationChange()">
  onLocationChange()
 </h3>
 <span class="indicatorInHeadline obsolete obsoleteMethod">
  Obsolete since Gecko 1.9.1 (Firefox 3.5 / Thunderbird 3.0 / SeaMonkey 2.0)
 </span>
</div>
<p>
</p>
<pre class="eval">void onLocationChange(
  in nsIWebProgress aWebProgress,
  in nsIRequest aRequest,
  in nsIURI aLocation,
  in nsIDownload aDownload
);
</pre>
<h6 id="Parameters" name="Parameters">
 Parameters
</h6>
<dl>
 <dt>
  <code>
   aWebProgress
  </code>
 </dt>
 <dd>
  The
  <code>
   <a href="/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIWebProgress" title="">
    nsIWebProgress
   </a>
  </code>
  instance used by the Download Manager to monitor downloads.
 </dd>
 <dt>
  <code>
   aRequest
  </code>
 </dt>
 <dd>
  The
  <code>
   <a href="/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIChannel" title="">
    nsIChannel
   </a>
  </code>
  that changed state. This parameter will not be
  <code>
   null
  </code>
  .
 </dd>
 <dt>
  <code>
   aLocation
  </code>
 </dt>
 <dd>
  The URI of the file being downloaded.
 </dd>
 <dt>
  <code>
   aDownload
  </code>
 </dt>
 <dd>
  The
  <code>
   <a href="/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIDownload" title="">
    nsIDownload
   </a>
  </code>
  object representing the file being downloaded.
 </dd>
</dl>
<h3 id="onProgressChange()" name="onProgressChange()">
 onProgressChange()
</h3>
<p>
 Called when the download progress level changes for a download.
</p>
<pre class="eval">void onProgressChange(
  in nsIWebProgress aWebProgress,
  in nsIRequest aRequest,
  in long long aCurSelfProgress,
  in long long aMaxSelfProgress,
  in long long aCurTotalProgress,
  in long long aMaxTotalProgress,
  in nsIDownload aDownload
);
</pre>
<h6 id="Parameters" name="Parameters">
 Parameters
</h6>
<dl>
 <dt>
  <code>
   aWebProgress
  </code>
 </dt>
 <dd>
  The
  <code>
   <a href="/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIWebProgress" title="">
    nsIWebProgress
   </a>
  </code>
  instance used by the Download Manager to monitor downloads.
 </dd>
 <dt>
  <code>
   aRequest
  </code>
 </dt>
 <dd>
  The
  <code>
   <a href="/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIChannel" title="">
    nsIChannel
   </a>
  </code>
  that changed state. This parameter will not be
  <code>
   null
  </code>
  .
 </dd>
 <dt>
  <code>
   aCurSelfProgress
  </code>
 </dt>
 <dd>
  The current amount of progress that's been made on the download specified by
  <code>
   aDownload
  </code>
  .
 </dd>
 <dt>
  <code>
   aMaxSelfProgress
  </code>
 </dt>
 <dd>
  The value that the self progress needs to reach to indicate that the download is complete.
 </dd>
 <dt>
  <code>
   aCurTotalProgress
  </code>
 </dt>
 <dd>
  The current amount of progress that's been made on all downloads.
 </dd>
 <dt>
  <code>
   aMaxTotalProgress
  </code>
 </dt>
 <dd>
  The value that the total progress needs to reach to indicate that all downloads are complete.
 </dd>
 <dt>
  <code>
   aDownload
  </code>
 </dt>
 <dd>
  The
  <code>
   <a href="/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIDownload" title="">
    nsIDownload
   </a>
  </code>
  object whose progress is represented by the
  <code>
   aCurSelfProgress
  </code>
  and
  <code>
   aMaxSelfProgress
  </code>
  parameters.
 </dd>
</dl>
<h3 id="onSecurityChange()" name="onSecurityChange()">
 onSecurityChange()
</h3>
<p>
 Called when the level of security being used while downloading changes; for example, if the initial request is made via HTTPS but the download switches to HTTP, this function gets called to notify you of that transition.
</p>
<pre class="eval">void onSecurityChange(
  in nsIWebProgress aWebProgress,
  in nsIRequest aRequest,
  in unsigned long aState,
  in nsIDownload aDownload
);
</pre>
<h6 id="Parameters" name="Parameters">
 Parameters
</h6>
<dl>
 <dt>
  <code>
   aWebProgress
  </code>
 </dt>
 <dd>
  The
  <code>
   <a href="/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIWebProgress" title="">
    nsIWebProgress
   </a>
  </code>
  instance used by the Download Manager to monitor downloads.
 </dd>
 <dt>
  <code>
   aRequest
  </code>
 </dt>
 <dd>
  The
  <code>
   <a href="/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIChannel" title="">
    nsIChannel
   </a>
  </code>
  that changed state. This parameter will not be
  <code>
   null
  </code>
  .
 </dd>
 <dt>
  <code>
   aState
  </code>
 </dt>
 <dd>
  The new state of the download. See
  <code>
   <a href="/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIDownloadManager">
    nsIDownloadManager.Constants
   </a>
  </code>
  for a list of possible values.
 </dd>
 <dt>
  <code>
   aDownload
  </code>
 </dt>
 <dd>
  The download whose security level is changing.
 </dd>
</dl>
<h3 id="onStateChange()" name="onStateChange()">
 onStateChange()
</h3>
<p>
 Called when the state of a particular download changes.
</p>
<pre class="eval">void onStateChange(
  in nsIWebProgress aWebProgress,
  in nsIRequest aRequest,
  in unsigned long aStateFlags,
  in nsresult aStatus,
  in nsIDownload aDownload
);
</pre>
<h6 id="Parameters" name="Parameters">
 Parameters
</h6>
<dl>
 <dt>
  <code>
   aWebProgress
  </code>
 </dt>
 <dd>
  The
  <code>
   <a href="/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIWebProgress" title="">
    nsIWebProgress
   </a>
  </code>
  instance used by the Download Manager to monitor downloads.
 </dd>
 <dt>
  <code>
   aRequest
  </code>
 </dt>
 <dd>
  The
  <code>
   <a href="/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIChannel" title="">
    nsIChannel
   </a>
  </code>
  that changed state. This parameter will not be
  <code>
   null
  </code>
  .
 </dd>
 <dt>
  <code>
   aStateFlags
  </code>
 </dt>
 <dd>
  Flags indicating the download's new state. This value is a combination of one of the
  <code>
   <a href="/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIWebProgressListener">
    nsIWebProgressListener.State_Transition_Flags
   </a>
  </code>
  .
 </dd>
 <dt>
  <code>
   aStatus
  </code>
 </dt>
 <dd>
  The new state information for the download. See
  <code>
   <a href="/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIWebProgressListener">
    nsIWebProgressListener.onStateChange()
   </a>
  </code>
  for details. This can also be one of the
  <code>
   <a href="/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIDownloadManager">
    nsIDownloadManager.Constants
   </a>
  </code>
  .
 </dd>
 <dt>
  <code>
   aDownload
  </code>
 </dt>
 <dd>
  The download whose state changed.
 </dd>
</dl>
<p>
</p>
<div class="headingWithIndicator">
 <h3 id="onStatusChange()">
  onStatusChange()
 </h3>
 <span class="indicatorInHeadline obsolete obsoleteMethod">
  Obsolete since Gecko 1.9.1 (Firefox 3.5 / Thunderbird 3.0 / SeaMonkey 2.0)
 </span>
</div>
<p>
</p>
<p>
 Called when the status of a download request has changed. The received status message is intended to be displayed visibly to the user.
</p>
<div class="note style-wrap">
 <p>
  <strong>
   Note:
  </strong>
  If source and destination are identical, which is possible in case of file URLs or chrome URLs, this is called even in
  <span title="(Firefox 3.6 / Thunderbird 3.1 / Fennec 1.0)">
   Gecko 1.9.2
  </span>
  . In such a situation no further event handlers are called and the stop flag is set; if there are more pending downloads in such a situation not yet started they never start. In normal situations this is never called. The method even if never called must be implemented in the listener, because the WebProgress used to do the physical part of the download requires it and uses the listener instance provided to the download manager.
 </p>
</div>
<pre class="eval">void onStatusChange(
  in nsIWebProgress aWebProgress,
  in nsIRequest aRequest,
  in nsresult aStatus,
  in wstring aMessage,
  in nsIDownload aDownload
);
</pre>
<h6 id="Parameters" name="Parameters">
 Parameters
</h6>
<dl>
 <dt>
  <code>
   aWebProgress
  </code>
 </dt>
 <dd>
  The
  <code>
   <a href="/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIWebProgress" title="">
    nsIWebProgress
   </a>
  </code>
  instance used by the Download Manager to monitor downloads.
 </dd>
 <dt>
  <code>
   aRequest
  </code>
 </dt>
 <dd>
  The
  <code>
   <a href="/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIRequest" title="">
    nsIRequest
   </a>
  </code>
  that changed state. This parameter will not be
  <code>
   null
  </code>
  .
 </dd>
 <dt>
  <code>
   aStatus
  </code>
 </dt>
 <dd>
  The new state information for the download. See
  <code>
   <a href="/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIWebProgressListener">
    nsIWebProgressListener.onStateChange()
   </a>
  </code>
  for details.
 </dd>
 <dt>
  <code>
   aMessage
  </code>
 </dt>
 <dd>
  A user-readable status message intended to be displayed visibly on the screen.
 </dd>
 <dt>
  <code>
   aDownload
  </code>
 </dt>
 <dd>
  The download whose status changed.
 </dd>
</dl>
<h2 id="Example" name="Example">
 Example
</h2>
<pre class="brush: js">var dm = Components.classes["@mozilla.org/download-manager;1"]
         .getService(Components.interfaces.nsIDownloadManager);

dm.addListener({
  onSecurityChange : function(prog, req, state, dl) { },
  onProgressChange : function(prog, req, prog, progMax, tProg, tProgMax, dl) { },
  onStateChange : function(prog, req, flags, status, dl) { },
  onDownloadStateChange : function(state, dl) { }
});
</pre>
<p>
 Even if you do not want to use some of the listeners, you
 <strong>
  must
 </strong>
 include all of them. An exception will be thrown if one of them is missing. Rather, only fill in the code for the ones you need, and leave the others blank as shown.
</p>
<h2 id="See_also" name="See_also">
 See also
</h2>
<ul>
 <li>
  <code>
   <a href="/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIDownloadManager" title="">
    nsIDownloadManager
   </a>
  </code>
 </li>
 <li>
  <code>
   <a href="/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIDownload" title="">
    nsIDownload
   </a>
  </code>
 </li>
 <li>
  <code>
   <a href="/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIWebProgressListener" title="">
    nsIWebProgressListener
   </a>
  </code>
 </li>
</ul></div><div id="footer"><hr/><p>This page was originally written for <a href="https://developer.mozilla.org">developer.mozilla.org</a> and is used here under the <a href="http://creativecommons.org/licenses/by-sa/2.5/">Creative Commons Attribution-ShareAlike license</a> (CC-BY-SA).</p>
<p>Original contributors to this page: <a href="https://developer.mozilla.org/en-US/profiles/wbamberg">wbamberg</a>, <a href="https://developer.mozilla.org/en-US/profiles/mdnwebdocs-bot">mdnwebdocs-bot</a>, <a href="https://developer.mozilla.org/en-US/profiles/SphinxKnight">SphinxKnight</a>, <a href="https://developer.mozilla.org/en-US/profiles/Sheppy">Sheppy</a>, <a href="https://developer.mozilla.org/en-US/profiles/Zeroe">Zeroe</a>, <a href="https://developer.mozilla.org/en-US/profiles/trevorh">trevorh</a>, <a href="https://developer.mozilla.org/en-US/profiles/Georgmaass">Georgmaass</a>, <a href="https://developer.mozilla.org/en-US/profiles/aavindraa">aavindraa</a>, <a href="https://developer.mozilla.org/en-US/profiles/dalbani">dalbani</a>, <a href="https://developer.mozilla.org/en-US/profiles/MarkFinkle">MarkFinkle</a>, <a href="https://developer.mozilla.org/en-US/profiles/Kohei">Kohei</a>, <a href="https://developer.mozilla.org/en-US/profiles/Graememcc">Graememcc</a>, <a href="https://developer.mozilla.org/en-US/profiles/Cdolivei">Cdolivei</a>, <a href="https://developer.mozilla.org/en-US/profiles/Nickolay">Nickolay</a>.</p></div></body>
</html>
