<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="https://code.cdn.mozilla.net/fonts/zilla-slab.css"/>
    <link rel="stylesheet" href="/css/page.css"/>
    <title>mozIAsyncFavicons</title>
  </head>

  <body><nav class="breadcrumbs"><a href="../../../../../Mozilla.html">Mozilla</a>&raquo;<a href="../../../../Tech.html">Tech</a>&raquo;<a href="../../../XPCOM.html">XPCOM</a>&raquo;<a href="../../Reference.html">Reference</a>&raquo;<a href="../Interface.html">Interface</a></nav><div class="content-heading"><h1>mozIAsyncFavicons</h1></div>
<div class="content"><div>
  <div style="border: solid #ddd 2px; margin-bottom: 12px;">
<div style="background: #eee; padding: 2px;"><code><a href="https://dxr.mozilla.org/mozilla-central/source/toolkit/components/places/mozIAsyncFavicons.idl" rel="custom">toolkit/components/places/mozIAsyncFavicons.idl</a></code><span style="text-align: right; float: right;"><a href="/en-US/docs/Interfaces/About_Scriptable_Interfaces" style="color: #00cc00; font-weight: 700;">Scriptable</a></span></div>
<span style="padding: 4px 2px;">

Interface for accessing the favicon service asynchronously.
</span>

  <div style="height: 42px; position: relative; padding: 2px; width: auto;">

  <div style="top: 22px; font-size: 11px; position: absolute;">1.0</div>
  
  <div style="top: 22px; font-size: 11px; position: absolute; left: 0px; text-align: right; float: right; width: 100%;">66</div>
  
  <div style="height: 8px; top: 16px; background: #dd0000; left: 0px; position: absolute; width: 14.285714285714285%;"></div>
  
<div style="height: 8px; top: 16px; left: 14.285714285714285%; background: #00dd00; position: absolute; width: 85.71428571428572%;" title="Introduced in Gecko 6.0 (Firefox 6.0 / Thunderbird 6.0 / SeaMonkey 2.3)"></div>

<div style="top: 0px; font-size: 11px; position: absolute; left: 14.285714285714285%;">Introduced</div>
<div style="top: 22px; font-size: 11px; position: absolute; left: 14.285714285714285%;">Gecko 6.0</div>

    <div style="height: 8px; top: 16px; left: 20.928571428571427%; background: #eeee00; position: absolute; width: 1%; border-radius: 4px; -webkit-border-radius: 4px;" title="Last changed in Gecko 11.0 (Firefox 11.0 / Thunderbird 11.0 / SeaMonkey 2.8)"></div>
    
</div>

<div style="background: #eee; padding: 2px;">
Inherits from: <code><a href="/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsISupports" title="">nsISupports</a></code>
<span style="text-align: right; float: right;">Last changed in Gecko 11.0 (Firefox 11.0 / Thunderbird 11.0 / SeaMonkey 2.8)</span></div>
</div></div>
<p><code><a href="/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIFaviconService" title="">nsIFaviconService</a></code> handles this interface, so you do not need to directly create a new service. Simply <code>QueryInterface()</code> the <code><a href="/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIFaviconService" title="">nsIFaviconService</a></code> to this interface. As an alternative, you can just use <code>PlacesUtils.favicons</code> from JavaScript.</p>
<h2 id="Method_overview" name="Method_overview">Method overview</h2>
<table class="standard-table">
  <tbody>
    <tr>
      <td><code>void <a href="#getFaviconURLForPage()">getFaviconURLForPage</a>(in nsIURI aPageURI, in nsIFaviconDataCallback aCallback);</code></td>
    </tr>
    <tr>
      <td><code>void <a href="#getFaviconDataForPage()">getFaviconDataForPage</a>(in nsIURI aPageURI, in nsIFaviconDataCallback aCallback);</code> </td>
    </tr>
    <tr>
      <td><code>void <a href="#setAndFetchFaviconForPage()">setAndFetchFaviconForPage</a>(in nsIURI aPageURI, in nsIURI aFaviconURI, in boolean aForceReload, in unsigned long aFaviconLoadType, [optional] in nsIFaviconDataCallback aCallback);</code></td>
    </tr>
    <tr>
      <td><code>void <a href="#replaceFaviconData()">replaceFaviconData</a>(in nsIURI aFaviconURI, [const,array,size_is(aDataLen)] in octet aData, in unsigned long aDataLen, in AUTF8String aMimeType, [optional] in PRTime aExpiration);</code> </td>
    </tr>
    <tr>
      <td><code>void <a href="#replaceFaviconDataFromDataURL()">replaceFaviconDataFromDataURL</a>(in nsIURI aFaviconURI, in AString aDataURL, [optional] in PRTime aExpiration<code>);</code> </code></td>
    </tr>
  </tbody>
</table>
<h2 id="Methods" name="Methods">Methods</h2>
<h3 id="getFaviconURLForPage()" name="getFaviconURLForPage()">getFaviconURLForPage()</h3>
<p>Retrieve the URL of the favicon for the given page.</p>
<pre>void getFaviconURLForPage(
  in nsIURI aPageURI,
  in nsIFaviconDataCallback aCallback
);
</pre>
<h4 id="getFaviconURLForPage-Parameters" name="getFaviconURLForPage-Parameters">Parameters</h4>
<dl>
  <dt>
    <code>aPageURI</code></dt>
  <dd>
    URI of the page whose favicon's URL we're looking up.</dd>
  <dt>
    <code>aCallback</code></dt>
  <dd>
    Once we have found the favicon's URL, we invoke this callback. Note that the callback's <code>aDataLen</code> will be 0, <code>aData</code> will be <code>null</code>, and <code>aMimeType</code> will be empty -- only <code>aURI</code> will be non-zero/null/empty.</dd>
</dl>
<h3 id="getFaviconDataForPage()" name="getFaviconDataForPage()">getFaviconDataForPage()</h3>
<p>Retrieves the favicon URI and data associated to the given page, if any.</p>
<pre>void getFaviconURLForPage(
  in nsIURI aPageURI,
  in nsIFaviconDataCallback aCallback
);
</pre>
<h4 id="getFaviconDataForPage-Parameters" name="getFaviconDataForPage-Parameters">Parameters</h4>
<dl>
  <dt>
    <code>aPageURI</code></dt>
  <dd>
    URI of the page whose favicon URI and data we're looking up.</dd>
  <dt>
    <code>aCallback</code></dt>
  <dd>
    This callback is always invoked to notify the result of the lookup. The <code>aURI</code> parameter will be the favicon URI, or null when no favicon is associated with the page or an error occurred while fetching it. If aURI is not null, the other parameters may contain the favicon data. However, if no favicon data is currently associated with the favicon URI, <code>aDataLen</code> will be 0, <code>aData</code> will be an empty array, and <code>aMimeType</code> will be an empty string.</dd>
</dl>
<h3 id="setAndFetchFaviconForPage()" name="setAndFetchFaviconForPage()">setAndFetchFaviconForPage()</h3>
<p>Declares that a given page uses a favicon with the given URI and attempts to fetch and save the icon data by loading the favicon URI through a asynchronous network request.</p>
<p>If the icon data already exists, we will not try to reload the icon unless <code>aForceReload</code> is <code>true</code>. Similarly, if the icon is in the failed favicon cache we will not do anything unless <code>aForceReload</code> is <code>true</code>, in which case we'll try to reload the favicon.</p>
<p>This function will only save favicons for "good" URIs, as defined by what gets added to history or is a bookmark. For "bad" URIs, this function will succeed but do nothing. This function will also ignore the error page favicon URI (see <code>FAVICON_ERRORPAGE_URL</code> in <a href="https://dxr.mozilla.org/mozilla-central/source/toolkit/components/places/public/nsIFaviconService.idl" rel="custom">nsIFaviconService.idl</a>).</p>
<p>Icons that fail to load will automatically be added to the failed favicon cache, and this function will not save favicons for non-bookmarked URIs when history is disabled.</p>
<div>
  <div class="blockIndicator note"><strong>Note:</strong>Â This function is identical to <code><a href="https://developer.mozilla.org/en-US/docs/XPCOM_Interface_Reference/nsIFaviconService#setAndLoadFaviconForPage()">nsIFaviconService.setAndLoadFaviconForPage()</a></code></div></div>
<pre>void setAndFetchFaviconForPage(
  in nsIURI aPageURI,
  in nsIURI aFaviconURI,
  in boolean aForceReload,
  in unsigned long afaviconLoadType, 
  in nsIFaviconDataCallback aCallback <span class="inlineIndicator optional optionalInline">Optional</span>
);
</pre>
<h4 id="setAndFetchFaviconForPage-Parameters" name="setAndFetchFaviconForPage-Parameters">Parameters</h4>
<dl>
  <dt>
    <code>aPageURI</code></dt>
  <dd>
    URI of the page whose favicon is being set.</dd>
  <dt>
    <code>aFaviconURI</code></dt>
  <dd>
    URI of the favicon to associate with the page.</dd>
  <dt>
    <code>aForceReload</code></dt>
  <dd>
    If <code>false</code>, we try to reload the favicon only if we do not have it or it has expired from the cache. Setting to <code>true</code> causes us to reload the favicon even if we have a usable copy.</dd>
  <dt>
    <code>aFaviconLoadType</code></dt>
  <dd>
    Set to nsIFaviconService.FAVICON_LOAD_PRIVATE if the favicon is loaded from a private browsing window. Set to nsIFaviconService.FAVICON_LOAD_NON_PRIVATE otherwise</dd>
  <dt>
    <code>aCallback</code> <span class="inlineIndicator optional optionalInline">Optional</span></dt>
  <dd>
    Once we're done setting and/or fetching the favicon, we invoke this callback.</dd>
</dl>
<h3 id="replaceFaviconData()" name="replaceFaviconData()">replaceFaviconData()</h3>
<p>Sets the data for a given favicon URI either by replacing existing data in the database or taking the place of otherwise fetched icon data when calling setAndFetchFaviconForPage later.</p>
<p>Favicon data for favicon URIs that are not associated with a page URI via setAndFetchFaviconForPage will be stored in memory, but may be expired at any time, so you should make an effort to associate favicon URIs with page URIs as soon as possible.</p>
<p>It's better to not use this function for chrome: icon URIs since you can reference the chrome image yourself. getFaviconLinkForIcon/Page will ignore any associated data if the favicon URI is "chrome:" and just return the same chrome URI.</p>
<p>This function does NOT send out notifications that the data has changed. Pages using this favicons that are visible in history or bookmarks views will keep the old icon until they have been refreshed by other means.</p>
<pre>void replaceFaviconData(
  in nsIURI aFaviconURI,
  [const,array,size_is(aDataLen)] in octet aData,
  in unsigned long aDataLen,
  in AUTF8String aMimeType,
  [optional] in PRTime aExpiration);
</pre>
<h4 id="replaceFaviconData-Parameters" name="replaceFaviconData-Parameters">Parameters</h4>
<dl>
  <dt>
    <code>aFaviconURI</code></dt>
  <dd>
    URI of the favicon whose data is being set.</dd>
  <dt>
    <code>aData</code></dt>
  <dd>
    Binary contents of the favicon to save.</dd>
  <dt>
    <code>aDataLen</code></dt>
  <dd>
    Length of binary data</dd>
  <dt>
    <code>aMimeType</code></dt>
  <dd>
    MIME type of the data to store. This is important so that we know what to report when the favicon is used. You should always set this param unless you are clearing an icon.</dd>
  <dt>
    <code>aExpiration</code> <span class="inlineIndicator optional optionalInline">Optional</span></dt>
  <dd>
    Time in microseconds since the epoch when this favicon expires. Until this time, we won't try to load it again.</dd>
</dl>
<h3 id="replaceFaviconDataFromDataURL()" name="replaceFaviconDataFromDataURL()">replaceFaviconDataFromDataURL()</h3>
<p>Same as <code><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/mozIAsyncFavicons#replaceFaviconData()">replaceFaviconData()</a></code> but the data is provided by a string containing a data URL.</p>
<p>Favicon data for favicon URIs that are not associated with a page URI via setAndFetchFaviconForPage will be stored in memory, but may be expired at any time, so you should make an effort to associate favicon URIs with page URIs as soon as possible.</p>
<p>It's better to not use this function for chrome: icon URIs since you can reference the chrome image yourself. getFaviconLinkForIcon/Page will ignore any associated data if the favicon URI is "chrome:" and just return the same chrome URI.</p>
<p>This function does NOT send out notifications that the data has changed. Pages using this favicons that are visible in history or bookmarks views will keep the old icon until they have been refreshed by other means.</p>
<pre>void replaceFaviconDataFromDataURL(
  in nsIURI aFaviconURI,
  in AString aDataURL,
  [optional] in PRTime aExpiration);
</pre>
<h4 id="replaceFaviconDataFromDataURL-Parameters" name="replaceFaviconDataFromDataURL-Parameters">Parameters</h4>
<dl>
  <dt>
    <code>aFaviconURI</code></dt>
  <dd>
    URI of the favicon whose data is being set.</dd>
  <dt>
    <code>aDataURL</code></dt>
  <dd>
    String containing a data URL that represents the contents of the favicon to save.</dd>
  <dt>
    <code>aExpiration</code> <span class="inlineIndicator optional optionalInline">Optional</span></dt>
  <dd>
    Time in microseconds since the epoch when this favicon expires. Until this time, we won't try to load it again./dd&gt;</dd>
  <dt>
    Â </dt>
</dl>
<h2 id="See_also" name="See_also">See also</h2>
<ul>
  <li><code><a href="/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIFaviconDataCallback" title="">nsIFaviconDataCallback</a></code></li>
</ul></div><div id="footer"><hr/><p>This page was originally written for <a href="https://developer.mozilla.org">developer.mozilla.org</a> and is used here under the <a href="http://creativecommons.org/licenses/by-sa/2.5/">Creative Commons Attribution-ShareAlike license</a> (CC-BY-SA).</p>
<p>Original contributors to this page: <a href="https://developer.mozilla.org/en-US/profiles/wbamberg">wbamberg</a>, <a href="https://developer.mozilla.org/en-US/profiles/mdnwebdocs-bot">mdnwebdocs-bot</a>, <a href="https://developer.mozilla.org/en-US/profiles/Sheppy">Sheppy</a>, <a href="https://developer.mozilla.org/en-US/profiles/Laurentj">Laurentj</a>, <a href="https://developer.mozilla.org/en-US/profiles/jwilde">jwilde</a>, <a href="https://developer.mozilla.org/en-US/profiles/Editmonkey">Editmonkey</a>, <a href="https://developer.mozilla.org/en-US/profiles/ethertank">ethertank</a>, <a href="https://developer.mozilla.org/en-US/profiles/MKaply">MKaply</a>, <a href="https://developer.mozilla.org/en-US/profiles/trevorh">trevorh</a>.</p></div></body>
</html>
