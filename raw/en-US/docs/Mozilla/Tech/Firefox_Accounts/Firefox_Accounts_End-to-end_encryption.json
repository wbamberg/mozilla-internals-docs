{
    "content": "<p>Firefox Accounts offers an end-to-end encryption support feature for OAuth reliers by deriving a strong encryption key from user's password. Keep in mind that Firefox Accounts does not provide a storage solution, it is up to you to use the generated key and encrypt the data with that key.</p>\n\n<h3 id=\"WebExtensions\">WebExtensions</h3>\n\n<p>To use this feature in WebExtensions you need to do the following:</p>\n\n<ol>\n <li><a href=\"https://developer.mozilla.org/en-US/docs/Mozilla/Tech/Firefox_Accounts/Introduction#OAuth_2.0_API\">Register an OAuth client</a> and an OAuth app scope with Firefox Accounts</li>\n <li>Install the <a href=\"https://github.com/mozilla/fxa-crypto-relier\">fxa-crypto-relier</a> library into your WebExtension</li>\n <li><a href=\"https://github.com/mozilla/fxa-crypto-relier/tree/master/docs\">Follow the documentation</a> to trigger the Firefox Accounts login screen</li>\n <li>Consume the derived key after the successful login</li>\n</ol>\n\n<h3 id=\"Examples\">Examples</h3>\n\n<p>You can find an example of this feature in the <a href=\"https://github.com/mozilla/notes/blob/5be89e52956182e57356b7ba9102d57cdb72be6f/src/background.js#L53-L72\">TestPilot Notes source code</a>. Here's a simplified diagram of a scoped key generated for a WebExtension:</p>\n\n<p><img alt=\"\" src=\"https://www.lucidchart.com/publicSegments/view/53ce9405-4ab6-481f-b8fe-0d47c0d29723/image.jpeg\" style=\"height: 816px; width: 1300px;\"></p>\n\n<p>An example of a key generated by Firefox Accounts: </p>\n\n<p><img alt=\"\" src=\"https://i.imgur.com/GdXHWVu.jpg\" style=\"height: 186px; width: 750px;\"></p>\n\n<p>The generated key can be imported using existing WebCrypto APIs:</p>\n\n<pre>function shared_key(key) {\n  return crypto.subtle.importKey(\n    'jwk',\n    { kty: key.kty, k: key.k.replace(/=/, '') },\n    'AES-KW',\n    true,\n    ['wrapKey', 'unwrapKey']\n  );\n}\n</pre>",
    "contributors": "<a href=\"https://developer.mozilla.org/en-US/profiles/wbamberg\">wbamberg</a>",
    "title": "Firefox Accounts End-to-end encryption"
}