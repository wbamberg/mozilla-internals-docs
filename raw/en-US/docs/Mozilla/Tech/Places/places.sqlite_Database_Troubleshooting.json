{
    "content": "<p>This article describes troubleshooting actions to deal with a broken places.sqlite database.</p>\n\n<h2 id=\"Places_Maintenance_Add-On\">Places Maintenance Add-On</h2>\n\n<p>This option is valid when:</p>\n\n<ul>\n <li>Bookmarks/History operations are slower than usual</li>\n <li>Some (not all) pages are strangely missing from the Awesomebar or history</li>\n <li>The Library and/or toolbar are not showing any bookmarks</li>\n <li>The browser hangs on shutdown</li>\n</ul>\n\n<p>This Firefox add-on calls maintenance code that is already in <a href=\"/en-US/docs/Mozilla/Tech/Places\">Places</a>, but that for whatever reason may not be runnning for some users.</p>\n\n<div class=\"warning\">\n<p>Always back up your profile folder before you try to fix it!</p>\n\n<p>https://support.mozilla.org/en-US/kb/back-and-restore-information-firefox-profiles</p>\n</div>\n\n<p><a href=\"https://addons.mozilla.org/firefox/addon/places-maintenance/\">https://addons.mozilla.org/en-US/firefox/addon/places-maintenance/</a></p>\n\n<h2 id=\"How_to_(try_to)_recover_from_a_corrupt_places.sqlite\">How to (try to) recover from a corrupt places.sqlite</h2>\n\n<p>Sometimes after a Firefox/Aurora/Nightly upgrade, history disappears, but bookmarks are at their place. In the profile folder a places.sqlite-corrupt file has been created.</p>\n\n<p>In some cases, this procedure may allow youÂ to recover the corrupt file along with all of its contents (history).</p>\n\n<p>Close Firefox and ensure it's done closing in your task manager.</p>\n\n<div class=\"warning\">\n<p>Before you proceed, make a backup of the Firefox profile folder, in any case.</p>\n</div>\n\n<p>Create a folder to use temporarily for this work, such as <em>my_work_folder</em>.<br>\n Copy places.sqlite-corrupt from the Firefox profile folder to the work folder.</p>\n\n<p>Download the latest precompiled binary Sqlite command-line shell from:<br>\n <a href=\"https://www.sqlite.org/download.html\">https://www.sqlite.org/download.html</a><br>\n Extract sqlite3 executable into the work folder.</p>\n\n<p>Open a terminal window and navigate to the work folder.<br>\n Then open an sqlite shell:</p>\n\n<pre class=\"brush: bash\"><strong>my_work_folder&gt;</strong> sqlite3 places.sqlite-corrupt\n\n<strong>sqlite&gt;</strong> PRAGMA integrity_check;</pre>\n\n<div class=\"note\">\n<p>If the result IS OK, this guide won't help; stop here and please <a href=\"https://bugzilla.mozilla.org/enter_bug.cgi?product=Toolkit&amp;component=Places\">file a bug</a>.</p>\n</div>\n\n<pre class=\"brush: bash\"><strong>sqlite&gt;</strong> .clone places.sqlite\n\n<strong>sqlite&gt;</strong> PRAGMA user_version;</pre>\n\n<p>Note the version number returned by the last pragma query.</p>\n\n<pre class=\"brush: bash\"><strong>sqlite&gt;</strong> .exit</pre>\n\n<p>Open a new shell for the new database:</p>\n\n<pre class=\"brush: bash\"><strong>my_work_folder&gt;</strong> sqlite3 places.sqlite\n\n<strong>sqlite&gt;</strong> PRAGMA integrity_check;</pre>\n\n<div class=\"note\">\n<p>If the result IS NOT OK, the file cannot be recovered; stop here and please <a href=\"https://bugzilla.mozilla.org/enter_bug.cgi?product=Toolkit&amp;component=Places\">file a bug</a>.</p>\n</div>\n\n<p>Let's fix the schema version.<br>\n <em>NN</em> must be replaced with the number we had noted previously:</p>\n\n<pre class=\"brush: bash\"><strong>sqlite&gt;</strong> PRAGMA user_version = <em>NN</em>;</pre>\n\n<p>Let's update the page_size value:</p>\n\n<pre class=\"brush: bash\"><strong>sqlite&gt;</strong> PRAGMA journal_mode = truncate;\n<strong>sqlite&gt;</strong> PRAGMA page_size = 32768;\n<strong>sqlite&gt;</strong> VACUUM;\n<strong>sqlite&gt;</strong> PRAGMA journal_mode = wal;\n<strong>sqlite&gt;</strong> .exit</pre>\n\n<p>Copy the new places.sqlite to the profile folder, overwriting the existing one.<br>\n Remove the places.sqlite-corrupt file.</p>\n\n<p>Launch Firefox.</p>\n\n<div class=\"note\">\n<p>If the database is still broken (missing history, creating -corrupt file, ...), please <a href=\"https://bugzilla.mozilla.org/enter_bug.cgi?product=Toolkit&amp;component=Places\">file a bug</a>.</p>\n</div>",
    "contributors": "<a href=\"https://developer.mozilla.org/en-US/profiles/wbamberg\">wbamberg</a>, <a href=\"https://developer.mozilla.org/en-US/profiles/mdnwebdocs-bot\">mdnwebdocs-bot</a>, <a href=\"https://developer.mozilla.org/en-US/profiles/beej\">beej</a>, <a href=\"https://developer.mozilla.org/en-US/profiles/douglas-j-bothwell\">douglas-j-bothwell</a>, <a href=\"https://developer.mozilla.org/en-US/profiles/Mak77\">Mak77</a>",
    "title": "places.sqlite Database Troubleshooting"
}