{
    "content": "<p></p><div class=\"prevnext\" style=\"text-align: right;\">\n    <p><a href=\"/en-US/docs/Creating_XPCOM_Components/Finishing_the_Component\" style=\"float: left;\">« Previous</a><a href=\"/en-US/docs/Creating_XPCOM_Components/Packaging_WebLock\">Next  »</a></p>\n</div><p></p>\n\n<p>Up until now, we've been building a component that can be installed in any Gecko application. The XPCOM interfaces and tools you've used have been general, cross-platform, and available in the Gecko Runtime Environment or in any Gecko-based application after Mozilla 1.2 (when the GRE began to be used).</p>\n\n<p>In this chapter, however, we are going to be building a user interface for the <strong>WebLock</strong> component that's meant to be added to the <em>existing</em> Mozilla browser<sup><a href=\"https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Guide/Creating_components/Building_the_WebLock_UI#endnote_other-mozlike-browsers\">[other-mozlike-browsers]</a></sup>. It uses <abbr title=\"XML UI Language\">XUL</abbr>, which is an XML language that Gecko knows how to render as user interface, but it also interacts with particular parts of the Mozilla user interface, where it must install itself as an extension to the UI. Specifically, the user interface we create in this chapter will be <em>overlaid</em> into the statusbar of the browser component, where it will provide a small icon the user can click to access the web lock interface.</p>\n\n<p><span id=\"WebLock_Indicator_in_Browser\"><a id=\"WebLock_Indicator_in_Browser\"></a><strong>WebLock Indicator in Browser</strong></span></p>\n\n<p><img alt=\"Image:web-lock-ui.png\" class=\"internal\" src=\"/@api/deki/files/962/=Web-lock-ui.png\"></p>\n\n<h3 id=\"User_Interface_Package_List\" name=\"User_Interface_Package_List\">User Interface Package List</h3>\n\n<p>The user interface described in this section is comprised of four files:</p>\n\n<ul>\n <li><code>webLockOverlay.xul</code> is the file that defines the little status icon in the browser.</li>\n <li><code>weblock.xul</code> defines the web lock manager dialog.</li>\n <li><code>weblock.css</code> provides style rules for both of the XUL files.</li>\n <li><code>weblock.js</code> provides JavaScript functions for both of the XUL files.</li>\n</ul>\n\n<p>Each of these files is described briefly in the sections below. In the following chapter we'll describe how you can take these files and create a <em>package</em>, an installable archive that includes the <strong>WebLock</strong> component and the new UI.</p>\n\n<p>Because this step (particularly the overlay section) is so dependent on Mozilla, the chapter is divided up into a couple of different sections. The second section, <a href=\"#XUL\">XUL</a>, describes the XML-based User Interface Language (XUL) and how you can use it to create a dialog that provides access to the <strong>WebLock</strong> component and its services. The third section, <a href=\"#Overlaying_New_User_Interface_Into_Mozilla\">Overlaying New User Interface Into Mozilla</a>, describes how to create an overlay into the browser that will make this dialog accessible from a Mozilla build. The overlay section, where we discuss how to import scripts, images, and other resources from Mozilla into your own UI, is by far the more complicated of the two.</p>\n\n<p>If the <strong>WebLock</strong> component is being installed in Mozilla or another Gecko-based browser, then this third section shows you how to create the entry point in the browser for controlling the web locking. If you are planning on deploying the <strong>WebLock</strong> component in some other application, you'll have to devise a different means of access (e.g., native widgetry that instantiates and controls the <strong>WebLock</strong> component).</p>\n\n<h3 id=\"Client_Code_Overview\" name=\"Client_Code_Overview\">Client Code Overview</h3>\n\n<p>Before we get started on the actual user interface, we should establish how the client code is to access the <strong>WebLock</strong> component and use its interfaces to control the web locking of the browser.</p>\n\n<p>First of all, it's important to be able to represent the basic state of the lock as soon as it's loaded. Like the secure page icon, the weblock icon that appears in the lower right corner of the browser should indicate whether the browser is currently locked or unlocked. Since the <strong>WebLock</strong> component is always initialized as unlocked, we can have the client code - the JavaScript code in the interface - represent this state and track it as the user manipulates the <code>iWebLock</code> interface. A boolean <code>wLocked</code> variable can do this:</p>\n\n<pre>// initialize the wLocked variable as unlocked\nvar wLocked = 0;\n</pre>\n\n<p>Then the functions that get called from the interface and call through to the <code>lock</code> and <code>unlock</code> methods of the <strong>WebLock</strong> component must also adjust this variable accordingly:</p>\n\n<pre>function wLock()\n{\n  // check to see if locking is on or off\n  weblock.lock();\n  wLocked = 1;\n}\n\nfunction wUnLock()\n{\n  // check to see if locking is on or off\n  weblock.unlock();\n  wLocked = 0;\n}\n</pre>\n\n<p>An important preliminary of these functions is that the <strong>WebLock</strong> component be made available to the JavaScript in the form of the <code>weblock</code> object being used in the snippets above. As you can see, <code>weblock</code> is initialized as a global JavaScript variable, available in the scope of these functions and others:</p>\n\n<pre>var weblock = Components.classes[\"@dougt/weblock\"]\n                        .getService()\n                        .QueryInterface(Components.interfaces.iWebLock); \n</pre>\n\n<p>In addition to this basic setup, you must also write JavaScript that uses the <code>AddSite</code> method to add new sites to the white list. This is a bit more complicated, because it requires that you work with the currently loaded page or provide other UI (e.g., a textfield where you can enter an arbitrary URL) for specifying URLs. In the <a href=\"#XUL\">XUL</a> section we'll go into how the user interface is defined. This section describes the functions that are called from the interface and how they interact with the <strong>WebLock</strong> component.</p>\n\n<p>The URL that the <code>AddSite</code> method expects is a string, so we can pass a string directly in from the user interface, or we can do a check on the string and verify that it's a valid URL. In this tutorial, focusing as it is on the <strong>WebLock</strong> functionality (rather than the UI), we'll assume the strings we get from the UI itself are URLs we actually want to write to the white list:</p>\n\n<pre>function addThisSite()\n{\n  var tf = document.getElementById(\"dialog.input\");\n  // weblock is global and declared above\n  weblock.AddSite(tf.value);\n}\n</pre>\n\n<p>This JavaScript function can be called directly from the XUL widget, where the input string is retrieved as the <code>value</code> property of the <code>textbox</code> element.</p>\n\n<p>You also need to create the function that displays the <strong>WebLock</strong> window itself when the user clicks the weblock icon in the statusbar. That function uses the <code>openDialog</code> method from the <code>window</code> object and takes the URL to the XUL file in which the dialog is defined:</p>\n\n<pre>function loadWebLock()\n{\n  window.openDialog(\"chrome://weblock/weblock.xul\");\n}\n</pre>\n\n<h3 id=\"XUL\" name=\"XUL\">XUL</h3>\n\n<p>The entire user interface of the Mozilla browser and all of the applications that go with it, including the mail client, the IRC client, and others, have been defined in an XML language called XUL. Elements in the XUL markup map to widgets in the interface that Gecko renders in a fairly straightforward way - so, for instance, the root element of an application window is the element <code>&lt;window/&gt;</code>, the root element of the dialog we'll be creating here is <code>&lt;dialog/&gt;</code>, and so forth. Within a XUL application file, elements like <code>&lt;button/&gt;</code>, <code>&lt;menu/&gt;</code>, and <code>&lt;checkbox/&gt;</code> can be hooked up to an event model, to scripts, and to the XPCOM interfaces that carry out a lot of the browser functionality in Mozilla.</p>\n\n<p>In <a href=\"/en/Creating_XPCOM_Components/Using_XPCOM_Components\" title=\"en/Creating_XPCOM_Components/Using_XPCOM_Components\">Using XPCOM Components</a> you saw how XPCOM objects are reflected into the interface layer as JavaScript objects. In this chapter, now that we've created the <strong>WebLock</strong> component and made it available to XPCOM, we create the UI that actually instantiates the <strong>WebLock</strong> component and uses its methods to control page loading in the browser.</p>\n\n<p>In the previous section, we outlined the JavaScript that interacts with the <strong>WebLock</strong> component. In this section, we are going to create the XUL interface that calls the JavaScript methods when the user interacts with it.</p>\n\n<h4 id=\"The_XUL_Document\" name=\"The_XUL_Document\">The XUL Document</h4>\n\n<p>The first thing to do is create the actual XUL document in which the user interface for the dialog and the events that initiate interaction with the web locking are defined. At the top of all XUL documents, an XML declaration is followed by the root element for the document, which is usually <code>&lt;window/&gt;</code> but for dialog boxes can also be the element <code>&lt;dialog/&gt;</code>. The \"shell\" for the XUL file, then, looks like this:</p>\n\n<pre>&lt;?xml version=\"1.0\"?&gt;\n&lt;?xml-stylesheet href=\"chrome://global/skin/\" type=\"text/css\"?&gt;\n\n&lt;dialog id=\"weblock_ui\"\n        xmlns=\"http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul\" \n        title=\"Web Lock Manager\"\n        persist=\"screenX screenY\"\n        screenX=\"24\" screenY=\"24\"&gt;\n\n&lt;/dialog&gt;\n</pre>\n\n<p>Note that this part of the XUL file also contains a stylesheet declaration, which imports CSS rules and applies them to particular parts of the interface. In Gecko, CSS is used to do virtually all of the presentation of the XUL interface - its color, position, style, and to some extent its behavior as well. The web lock manager dialog does not deviate from the look of a standard dialog, so it can use a single declaration to import the \"global\" skin from the browser and make it available to the widgets you define in <code>weblock.xul</code>.</p>\n\n<p>You can save this first, outermost part of the web lock dialog in a file called <code>weblock.xul</code>, which you'll be adding to an installer archive in Appendix B in this book.</p>\n\n<div class=\"side-note\">\n<p>Note that this file defines the dialog that displays when the user/administrator clicks the web locking icon in the bottom right corner of the browser. That piece of UI - which needs to be dynamically inserted into the browser at runtime - is described in <a href=\"#Overlaying_New_User_Interface_Into_Mozilla\">Overlaying New User Interface Into Mozilla</a>.</p>\n</div>\n\n<p>The finished dialog appears below.</p>\n\n<p><span id=\"Web_Lock_Manager_Dialog\"><a id=\"Web_Lock_Manager_Dialog\"></a><strong>Web Lock Manager Dialog</strong></span></p>\n\n<p><img alt=\"Image:Weblock-sitelist-ui.png\" class=\"internal\" src=\"/@api/deki/files/416/=Weblock-sitelist-ui.png\"></p>\n\n<p>As you can see, it's a simple interface, providing just enough widgetry to lock and unlock the browser and to add new sites to the list. The entire XUL file for the web lock manager dialog is defined in <a href=\"#weblock.xul\">weblock.xul</a> below.</p>\n\n<h4 id=\"The_Locking_UI\" name=\"The_Locking_UI\">The Locking UI</h4>\n\n<p>Once you have the basic XUL wrapper set up for your interface, the next step is to define that part of the interface that locks and unlocks the browser. One of the most efficient ways to expose this is to use radio buttons, which allow the user to toggle a particulart state, as the figure above illustrates.</p>\n\n<p>In XUL individual <code>&lt;radio/&gt;</code> elements are contained within a parent element called <code>&lt;radiogroup/&gt;</code>. Grouping radio elements together creates the toggling UI by requiring that one or another of the elements be selected, but not both.</p>\n\n<p>The XUL that defines the radiogroup in the web lock manager dialog is this:</p>\n\n<pre>&lt;radiogroup&gt; \n   &lt;radio label=\"lock\"/&gt;\n   &lt;radio label=\"unlock\" selected=\"true\"/&gt;\n&lt;/radiogroup&gt;\n</pre>\n\n<p>Since the <strong>WebLock</strong> component always starts up in the unlocked position, you can add the <code>selected=\"true\"</code> attribute and value on the unlock radio button and reset it dynamically as the user takes action.</p>\n\n<h4 id=\"Site_Adding_UI\" name=\"Site_Adding_UI\">Site Adding UI</h4>\n\n<p>The next step is to create that part of the user interface that lets you add a new site to the white list. There are other, more sophisticated ways to do this; you may also want to include some UI that lets you view the white list or edit it as a list. In this part of the tutorial, however, we only provide the means of adding an URL provided as a string (which is not checked for validity) and passing it through to the <code>AddSite</code> API we defined in the earlier part of the tutorial.</p>\n\n<pre>&lt;separator class=\"thin\"/&gt;\n\n&lt;hbox align=\"center\"&gt;\n  &lt;textbox id=\"url.input\" flex=\"1\"/&gt;\n  &lt;button label=\"Add this URL\" oncommand=\"addThisSite();\"/&gt;\n&lt;/hbox&gt; \n</pre>\n\n<p>This snippet introduces a couple of new general layout widgets in XUL. The separator that appears at the top of this snippet creates a little divider between widgets like the kind you see in menus that divide sets of functionality available there. The parent of the textbox that users enter an URL into is something called an <code>&lt;hbox/&gt;</code>, which is a layout widget - often invisible - that controls the way its child elements are rendered. In this case the <code>&lt;hbox/&gt;</code> centers the textbox and the button children, and it orients them horizontally (in contrast to the <code>&lt;vbox/&gt;</code>, which orients its children vertically).</p>\n\n<p>Notice also that when it's clicked, the button executes a JavaScript function called <code>addThisSite()</code>, which we've already defined in the <code>weblock.js</code> file in <a href=\"#Client_Code_Overview\">Client Code Overview</a> above.</p>\n\n<h4 id=\"weblock.xul\" name=\"weblock.xul\"><code>weblock.xul</code></h4>\n\n<pre>&lt;?xml version=\"1.0\"?&gt;\n&lt;?xml-stylesheet href=\"chrome://global/skin/\" type=\"text/css\"?&gt;\n\n&lt;dialog id=\"weblock_mgg\"\n        xmlns=\"http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul\"\n\ttitle=\"Web Lock Manager\"\n        style=\"width: 30em;\"\n        persist=\"screenX screenY\"\n        screenX=\"24\" screenY=\"24\"&gt;\n\n  &lt;script src=\"chrome://weblock/content/weblock.js\"/&gt;\n\n  &lt;hbox&gt;\n    &lt;separator orient=\"vertical\" class=\"thin\"/&gt;\n    &lt;vbox flex=\"1\"&gt;\n      &lt;separator class=\"thin\"/&gt;\n      &lt;hbox align=\"center\"&gt;\n        &lt;textbox id=\"dialog.input\" flex=\"1\"/&gt;\n        &lt;button label=\"Add this URL\"\n                oncommand=\"addThisSite();\"/&gt;\n      &lt;/hbox&gt;\n      &lt;hbox align=\"center\"&gt;\n        &lt;radiogroup onchange=\"toggleLock();\"&gt;\n          &lt;radio label=\"lock\"/&gt;\n          &lt;radio label=\"unlock\"/&gt;\n        &lt;/radiogroup&gt;\n        &lt;spacer flex=\"1\"/&gt;\n      &lt;/hbox&gt;\n    &lt;/vbox&gt;\n  &lt;/hbox&gt;\n\n&lt;/dialog&gt; \n</pre>\n\n<h3 id=\"Overlaying_New_User_Interface_Into_Mozilla\" name=\"Overlaying_New_User_Interface_Into_Mozilla\">Overlaying New User Interface Into Mozilla</h3>\n\n<p>You've got a dialog that will interact with the <strong>WebLock</strong> component, but how do you install the dialog you've created into the browser? And how do you access it once it's installed? Once it's installed and registered, the <strong>WebLock</strong> component itself is ready to go: XPCOM finds it and adds it to the list of registered components, and then WebLock observes the XPCOM startup event and initializes itself.</p>\n\n<p>But you still have to add your new UI into the browser so it can call the component, and the Mozilla overlay mechanism is the way to do this. Overlays are XUL files that register themselves to be dynamically inserted into the appropriate parts of the browser UI at runtime.</p>\n\n<h4 id=\"webLockOverlay.xul\" name=\"webLockOverlay.xul\"><code>webLockOverlay.xul</code></h4>\n\n<p>The XUL that defines the new icon is small: it's a little icon that calls a JavaScript function to load the <code>weblock.xul</code> file we defined previously. The icon is actually a separate <code>&lt;statusbarpanel/&gt;</code> element that gets overlaid into the main browser, along with some JavaScript and some CSS to control the behavior and appearance of the element, respectively. Here is that XUL file in its entirety:</p>\n\n<p><span id=\"The_WebLock_Overlay\"><a id=\"The_WebLock_Overlay\"></a><strong>The WebLock Overlay</strong></span></p>\n\n<pre>&lt;?xml version=\"1.0\"?&gt;\n&lt;?xml-stylesheet href=\"chrome://navigator/content/weblock.css\" type=\"text/css\"?&gt;\n\n&lt;overlay id=\"weblockOverlay\"\n         xmlns=\"http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul\"&gt;\n\n  &lt;script type=\"application/javascript\"\n          src=\"chrome://weblock/content/weblock.js\"/&gt;\n\n  &lt;statusbar id=\"status-bar\"&gt;\n    &lt;statusbarpanel class=\"statusbarpanel-iconic\"\n                    id=\"weblock-status\"\n                    insertbefore=\"offline-status\"\n                    oncommand=\"loadWebLock();\"\n                    status=\"none\"/&gt;\n  &lt;/statusbar&gt;\n\n&lt;/overlay&gt; \n</pre>\n\n<p>Note that the root element for this file is not a <code>&lt;window/&gt;</code> but an <code>&lt;overlay/&gt;</code>. In overlays the ordinarily unique <code>id</code> attributes that XUL elements use to distinguish themselves are purposely made redundant with UI in the existing browser with which they should be merged. In this case, the weblock <code>&lt;statusbarpanel/&gt;</code> appears as a child of the <code>&lt;statusbar/&gt;</code> element with <code>id</code> \"status-bar\". This <code>id</code> is the same one used by the <code>&lt;statusbar/&gt;</code> in <code>navigator.xul</code>, which means that the overlay mechanism will merge the new UI here (i.e., the weblock statusbarpanel) and the UI already defined within that browser <code>&lt;statusbar/&gt;</code> at runtime.</p>\n\n<h3 id=\"Other_Resources\" name=\"Other_Resources\">Other Resources</h3>\n\n<p>This chapter describes the remaining files that must be added to and packaged up with the <strong>WebLock</strong> component to provide user interface for web locking.</p>\n\n<div class=\"side-note\">\n<p><span id=\"Other_Front_End_Resources\"><a id=\"Other_Front_End_Resources\"></a><strong>Other Front End Resources</strong></span></p>\n\n<p>In some UI packages, localization resources are also defined. These include DTDs in which the language in which the UI is labelled can be extracted into external files, which are swapped with DTDs for other languages. For example, user interface packages often include an English DTD that defines labels and strings for button and menus and other elements in the interface. When the user selects a different <em>language pack</em>, all of the English that's been externalized in these files is dynamically replaced with the new choice. In addition to DTDs, the localization parts of a user interface may also include string bundles in which strings that are used in the interface JavaScript can be similarly replaced. There are also technologies, not discussed here, which may be used in separate, installable files. These include <em>bindings</em> in XML files, <em>metadata</em> in RDF files, whole collections of CSS files called <em>skins</em>, and others.</p>\n</div>\n\n<h4 id=\"weblock.css\" name=\"weblock.css\">weblock.css</h4>\n\n<p>The following style rules are defined in <code>weblock.css</code>, a CSS file that is loaded by the overlay and applied to the icon in the browser that reflects the current status of the web lock and provides access to the web lock manager dialog.</p>\n\n<pre>statusbarpanel#weblock-status\n{\n  list-style-image: url(\"chrome://weblock/wlock.gif\");\n}\n\nstatusbarpanel#weblock-status[status=\"locked\"]\n{\n  list-style-image: url(\"chrome://weblock/wl-lock.gif\");\n}\n\nstatusbarpanel#weblock-status[status=\"unlocked\"]\n{\n  list-style-image: url(\"chrome://weblock/wl-un.gif\");\n}\n</pre>\n\n<p>The style rules are distinguished by the state of the <code>status</code> attribute on the element in the XUL with the <code>id</code> \"weblock-status.\" As you can see above, when the status of the element is set to \"locked\", the image <code>wl-lock.gif</code> is used to show the state, and when the web locking is unlocked, it uses <code>wl-un.gif</code>. (Note: We include three images to represent the state of the weblock, but <code>wlock.gif</code> and <code>wl-lock.gif</code> are identical, since weblock is presumed to be unlocked when it's loaded. This tutorial makes use of only two different states, but you can further customize the look of the weblock using the three images if you wish.)</p>\n\n<p>Since the presentation of the weblock manager dialog itself doesn't require any special styles, these are all the rules you need in the <code>weblock.css</code>. Note that the <code>weblock.xul</code> file in which the manager is defined imports only the global skin:</p>\n\n<pre>&lt;?xml-stylesheet href=\"chrome://global/skin/\" type=\"text/css\"?&gt;\n</pre>\n\n<p>Save <code>weblock.css</code> in your working directory.</p>\n\n<p>You should now have the four files listed at the top of this chapter as the \"packing list\" for the <strong>WebLock</strong> package (see <a href=\"#User_Interface_Package_List\">User Interface Package List</a>). Don't worry for now about where these files are. In the next chapter, <a href=\"/en/Creating_XPCOM_Components/Packaging_WebLock\" title=\"en/Creating_XPCOM_Components/Packaging_WebLock\">Packaging WebLock</a>, we'll describe how to organize and package them so that they can be installed along with the <strong>WebLock</strong> component itself and the other resources.</p>\n\n<h4 id=\"Image_Resources\" name=\"Image_Resources\">Image Resources</h4>\n\n<p>If you are following along with this tutorial and want to use the images we use here for the states of the <strong>WebLock</strong> component in the statusbar, you can download them and the other resources for <strong>WebLock</strong> from <a class=\"external\" href=\"http://www.brownhen.com/weblock\" rel=\"freelink\">http://www.brownhen.com/weblock</a>. The GIF files that represent the various states are:</p>\n\n<ul>\n <li><code>wlock.gif</code></li>\n <li><code>wl-lock.gif</code></li>\n <li><code>wl-un.gif</code></li>\n</ul>\n\n<ol>\n <li><div class=\"blockIndicator note\"><strong>Note:</strong> other-mozlike-browsers</div> Or one very much like it. There are Gecko-based browsers such as Beonex and the IBM Web Browser that share a lot of the structure of the Mozilla user interface, into which it may be possible to install both the <strong>WebLock</strong> component and the user interface described in this chapter. Note, however, that currently <strong>WebLock</strong> probably does not install cleanly in Mozilla Firefox due to Firefox's newness compared to this book (which was originally written in 2003).</li>\n</ol>\n\n<p></p><div class=\"prevnext\" style=\"text-align: right;\">\n    <p><a href=\"/en-US/docs/Creating_XPCOM_Components/Finishing_the_Component\" style=\"float: left;\">« Previous</a><a href=\"/en-US/docs/Creating_XPCOM_Components/Packaging_WebLock\">Next  »</a></p>\n</div> <p></p><div class=\"licenseblock\">\n<p>Copyright (c) 2003 by Doug Turner and Ian Oeschger. This material may be distributed only subject to the terms and conditions set forth in the <a class=\"external\" href=\"http://www.opencontent.org/openpub/\" rel=\"noopener\">Open Publication License</a>, v1.02 or later. Distribution of substantively modified versions of this document is prohibited without the explicit permission of the copyright holder. Distribution of the work or derivative of the work in any standard (paper) book form is prohibited unless prior permission is obtained from the copyright holder.</p>\n</div><p></p>",
    "contributors": "<a href=\"https://developer.mozilla.org/en-US/profiles/wbamberg\">wbamberg</a>, <a href=\"https://developer.mozilla.org/en-US/profiles/mdnwebdocs-bot\">mdnwebdocs-bot</a>, <a href=\"https://developer.mozilla.org/en-US/profiles/Sheppy\">Sheppy</a>, <a href=\"https://developer.mozilla.org/en-US/profiles/trevorh\">trevorh</a>, <a href=\"https://developer.mozilla.org/en-US/profiles/David.humphrey\">David.humphrey</a>, <a href=\"https://developer.mozilla.org/en-US/profiles/Waldo\">Waldo</a>",
    "title": "Building the WebLock UI"
}